# Учебная практика: Анализ рисков программных систем (C++ + Crow)
## 1. Теоретическая часть

### Основные понятия

- **Угроза (Threat):** Потенциальное событие, способное нанести вред системе (например, атака злоумышленника).
- **Уязвимость (Vulnerability):** Слабое место в системе, которое может быть использовано угрозой (например, отсутствие авторизации).
- **Риск (Risk):** Вероятность того, что угроза воспользуется уязвимостью и приведёт к ущербу.

### STRIDE-классификация угроз

| Тип                     | Значение                |
|-------------------------|-------------------------|
| Spoofing                | Подмена личности        |
| Tampering               | Изменение данных        |
| Repudiation             | Отказ от действий       |
| Information Disclosure  | Утечка информации      |
| Denial of Service       | Вывод из строя          |
| Elevation of Privilege  | Повышение привилегий    |

**Формула оценки риска:**  
`Риск = Вероятность × Влияние`

## 2. Проект на C++ с Crow: Веб-сервер без авторизации

### Структура проекта

risk-analyzer/
├── CMakeLists.txt
├── main.cpp
└── README.md
### Пример кода (`main.cpp`)

#include "crow_all.h"

int main() {
crow::SimpleApp app;

text
CROW_ROUTE(app, "/public")
([](){
    return " Это общедоступная информация.";
});

CROW_ROUTE(app, "/secret")
([](const crow::request& req){
    return crow::response(403, " Нет доступа! Авторизуйся!");
});

app.port(18080).multithreaded().run();

}

### Действия

1. Запустить сервер.
2. Открыть `/public` и `/secret` в браузере.

## 3. Анализ потенциальных рисков

### До внедрения авторизации

| Риск                       | Вероятность | Влияние   | Оценка риска | Меры снижения                |
|----------------------------|-------------|-----------|--------------|------------------------------|
| Нет авторизации            | Высокая     | Критично  | Критичный    | Добавить проверку логина     |
| Пароль в GET-запросе       | Высокая     | Среднее   | Высокий      | Перейти на POST, добавить HTTPS |
| Нет ограничения попыток    | Средняя     | Среднее   | Средний      | Ввести лимит попыток         |
| Утечка информации через /secret | Высокая | Среднее   | Высокий      | Ограничить доступ, логировать запросы |
| Возможность DoS-атаки      | Средняя     | Высокое   | Высокий      | Ввести rate limiting         |

### STRIDE-анализ

- **Spoofing:** Нет проверки личности - любой может попытаться получить доступ к /secret.
- **Tampering:** Нет проверки целостности данных, но для GET-запросов риск минимален.
- **Repudiation:** Нет логирования действий - пользователь может отрицать доступ.
- **Information Disclosure:** /secret открыт для всех - риск утечки.
- **Denial of Service:** Нет защиты от большого числа запросов.
- **Elevation of Privilege:** Нет разграничения ролей.

## 4. Улучшения: авторизация и хранение сессии

### Добавление авторизации

- Новый эндпоинт: `/login?user=admin&pass=1234`
- При успешном логине - установка cookie/сессии.
- Проверка сессии для доступа к `/secret`.

**Пример логики (псевдокод):**

CROW_ROUTE(app, "/login")
([](const crow::request& req){
auto user = req.url_params.get("user");
auto pass = req.url_params.get("pass");
if (user && pass && strcmp(user, "admin") == 0 && strcmp(pass, "1234") == 0) {
crow::response res(" Авторизация успешна");
res.add_header("Set-Cookie", "session=admin; HttpOnly");
return res;
}
return crow::response(401, " Неверные данные");
});

CROW_ROUTE(app, "/secret")
([](const crow::request& req){
auto cookie = req.get_header_value("Cookie");
if (cookie.find("session=admin") != std::string::npos) {
return crow::response(" Секретная информация");
}
return crow::response(403, " Нет доступа! Авторизуйся!");
});

## 5. Оценка рисков после изменений

| Риск                       | Вероятность | Влияние   | Оценка риска | Меры снижения                |
|----------------------------|-------------|-----------|--------------|------------------------------|
| Нет авторизации            | Низкая      | Критично  | Средний      | Авторизация реализована      |
| Пароль в GET-запросе       | Средняя     | Среднее   | Средний      | Перейти на POST, добавить HTTPS |
| Нет ограничения попыток    | Средняя     | Среднее   | Средний      | Ввести лимит попыток         |
| Утечка информации через /secret | Низкая | Среднее   | Низкий       | Доступ только сессии         |
| Возможность DoS-атаки      | Средняя     | Высокое   | Высокий      | Ввести rate limiting         |

## 6. Выводы

- **Какие риски были устранены?**  
  - Неавторизованный доступ к /secret
  - Утечка информации через открытый эндпоинт

- **Что оказалось сложным?**  
  - Реализация безопасного хранения сессии в минималистичном сервере
  - Безопасная передача пароля (GET-запрос - не лучшая практика)

- **Какие улучшения можно внести?**  
  - Перейти на POST-запросы для логина
  - Использовать HTTPS для защиты данных
  - Добавить ограничение попыток входа (brute-force protection)
  - Ввести ролевую модель (admin/user)
  - Логировать все подозрительные действия

- **Как бы вы атаковали своё приложение?**  
  - Подбор пароля через перебор (brute-force)
  - Перехват cookie в незашифрованном соединении
  - Попытка доступа к /secret без авторизации
